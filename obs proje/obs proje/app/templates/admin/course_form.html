{% extends "base.html" %}

{% block title %}{% if course %}Ders Düzenle{% else %}Yeni Ders Ekle{% endif %}{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="breadcrumb">
        <a href="{{ url_for('admin.courses') }}"><i class="fas fa-arrow-left"></i> Ders Listesi</a>
    </div>
    
    <div class="form-container">
        <h1>{% if course %}{{ course.code }} - Düzenle{% else %}Yeni Ders Ekle{% endif %}</h1>
        
        <form method="POST" class="admin-form">
            <div class="form-section">
                <h3>Temel Bilgiler</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="code">Ders Kodu *</label>
                        <input type="text" id="code" name="code" 
                               value="{{ course.code if course else '' }}"
                               placeholder="Örn: BIL101" required
                               {% if course %}readonly{% endif %}>
                    </div>
                    
                    <div class="form-group">
                        <label for="name">Ders Adı *</label>
                        <input type="text" id="name" name="name" 
                               value="{{ course.name if course else '' }}"
                               placeholder="Örn: Programlamaya Giriş" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="description">Açıklama</label>
                    <textarea id="description" name="description" rows="3"
                              placeholder="Ders açıklaması...">{{ course.description if course else '' }}</textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="department">Bölüm *</label>
                        <input type="text" id="department" name="department" 
                               value="{{ course.department if course else '' }}"
                               list="departments" placeholder="Bölüm seçin" required>
                        <datalist id="departments">
                            {% for dept in departments %}
                                <option value="{{ dept }}">
                            {% endfor %}
                            <option value="Bilgisayar Mühendisliği">
                            <option value="Elektrik-Elektronik Mühendisliği">
                            <option value="Makine Mühendisliği">
                        </datalist>
                    </div>
                    
                    <div class="form-group">
                        <label for="faculty">Fakülte *</label>
                        <input type="text" id="faculty" name="faculty" 
                               value="{{ course.faculty if course else '' }}"
                               list="faculties" placeholder="Fakülte seçin" required>
                        <datalist id="faculties">
                            {% for fac in faculties %}
                                <option value="{{ fac }}">
                            {% endfor %}
                            <option value="Mühendislik Fakültesi">
                            <option value="Fen Fakültesi">
                        </datalist>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="credit">Kredi *</label>
                        <input type="number" id="credit" name="credit" 
                               value="{{ course.credit if course else 3 }}" min="1" max="10" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="ects">AKTS</label>
                        <input type="number" id="ects" name="ects" 
                               value="{{ course.ects if course else 5 }}" min="1" max="30">
                    </div>
                    
                    <div class="form-group">
                        <label for="quota">Kontenjan *</label>
                        <input type="number" id="quota" name="quota" 
                               value="{{ course.quota if course else 50 }}" min="1" max="500" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="course_type">Ders Türü</label>
                        <select id="course_type" name="course_type">
                            <option value="required" {% if course and course.course_type == 'required' %}selected{% endif %}>Zorunlu</option>
                            <option value="elective" {% if (course and course.course_type == 'elective') or not course %}selected{% endif %}>Seçmeli</option>
                            <option value="technical_elective" {% if course and course.course_type == 'technical_elective' %}selected{% endif %}>Teknik Seçmeli</option>
                        </select>
                    </div>
                </div>
                
                {% if course %}
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="is_open" {% if course.is_open %}checked{% endif %}>
                            <span>Kayıta Açık</span>
                        </label>
                    </div>
                {% endif %}
            </div>
            
            <div class="form-section">
                <h3>Ders Programı</h3>
                <p class="section-desc">Dersin haftalık programını ekleyin</p>
                
                <div id="scheduleContainer">
                    {% if course and course.schedules.count() > 0 %}
                        {% for sched in course.schedules %}
                            <div class="schedule-row">
                                <select name="day[]" required>
                                    <option value="">Gün Seçin</option>
                                    <option value="Pazartesi" {% if sched.day == 'Pazartesi' %}selected{% endif %}>Pazartesi</option>
                                    <option value="Salı" {% if sched.day == 'Salı' %}selected{% endif %}>Salı</option>
                                    <option value="Çarşamba" {% if sched.day == 'Çarşamba' %}selected{% endif %}>Çarşamba</option>
                                    <option value="Perşembe" {% if sched.day == 'Perşembe' %}selected{% endif %}>Perşembe</option>
                                    <option value="Cuma" {% if sched.day == 'Cuma' %}selected{% endif %}>Cuma</option>
                                    <option value="Cumartesi" {% if sched.day == 'Cumartesi' %}selected{% endif %}>Cumartesi</option>
                                </select>
                                <input type="time" name="start_time[]" value="{{ sched.start_time }}" required>
                                <input type="time" name="end_time[]" value="{{ sched.end_time }}" required>
                                <input type="text" name="classroom[]" value="{{ sched.classroom or '' }}" placeholder="Derslik">
                                <button type="button" class="btn btn-sm btn-danger remove-schedule">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="schedule-row">
                            <select name="day[]" required>
                                <option value="">Gün Seçin</option>
                                <option value="Pazartesi">Pazartesi</option>
                                <option value="Salı">Salı</option>
                                <option value="Çarşamba">Çarşamba</option>
                                <option value="Perşembe">Perşembe</option>
                                <option value="Cuma">Cuma</option>
                                <option value="Cumartesi">Cumartesi</option>
                            </select>
                            <input type="time" name="start_time[]" value="09:00" required>
                            <input type="time" name="end_time[]" value="11:00" required>
                            <input type="text" name="classroom[]" placeholder="Derslik">
                            <button type="button" class="btn btn-sm btn-danger remove-schedule">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    {% endif %}
                </div>
                
                <button type="button" id="addSchedule" class="btn btn-outline btn-sm">
                    <i class="fas fa-plus"></i> Saat Ekle
                </button>
            </div>
            
            <div class="form-section">
                <h3>Ön Şartlar</h3>
                <p class="section-desc">Ders kodlarını virgülle ayırarak girin (ör: BIL101, BIL102)</p>
                
                <div class="form-group">
                    <input type="text" id="prerequisites" name="prerequisites" 
                           value="{{ course.get_prerequisite_codes()|join(', ') if course else '' }}"
                           placeholder="Örn: BIL101, BIL102">
                </div>
            </div>
            
            <div class="form-actions">
                <a href="{{ url_for('admin.courses') }}" class="btn btn-outline">İptal</a>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> {% if course %}Güncelle{% else %}Kaydet{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('addSchedule').addEventListener('click', function() {
    const container = document.getElementById('scheduleContainer');
    const row = document.createElement('div');
    row.className = 'schedule-row';
    row.innerHTML = `
        <select name="day[]" required>
            <option value="">Gün Seçin</option>
            <option value="Pazartesi">Pazartesi</option>
            <option value="Salı">Salı</option>
            <option value="Çarşamba">Çarşamba</option>
            <option value="Perşembe">Perşembe</option>
            <option value="Cuma">Cuma</option>
            <option value="Cumartesi">Cumartesi</option>
        </select>
        <input type="time" name="start_time[]" value="09:00" required>
        <input type="time" name="end_time[]" value="11:00" required>
        <input type="text" name="classroom[]" placeholder="Derslik">
        <button type="button" class="btn btn-sm btn-danger remove-schedule">
            <i class="fas fa-times"></i>
        </button>
    `;
    container.appendChild(row);
});

document.addEventListener('click', function(e) {
    if (e.target.closest('.remove-schedule')) {
        const row = e.target.closest('.schedule-row');
        const container = document.getElementById('scheduleContainer');
        if (container.children.length > 1) {
            row.remove();
        }
    }
});
</script>
{% endblock %}
